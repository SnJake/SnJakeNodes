# –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è "—Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö" —Å–∏–≥–Ω–∞–ª–æ–≤.
# –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.
TELEPORT_DATA = {}

# –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–º–µ–Ω –∫–æ–Ω—Å—Ç–∞–Ω—Ç.
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤ –Ω–æ–¥–µ Get.
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å –æ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ.
TELEPORT_CONSTANTS = {"default_constant"}


class AlwaysEqualProxy(str):
    """
    –ö–ª–∞—Å—Å-–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö "ANY" (*).
    –û–±—ä–µ–∫—Ç —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ –≤—Å–µ–≥–¥–∞ —Ä–∞–≤–µ–Ω –ª—é–±–æ–º—É –¥—Ä—É–≥–æ–º—É –æ–±—ä–µ–∫—Ç—É,
    —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ö–æ–¥–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ –≤ ComfyUI.
    """
    def __eq__(self, _):
        return True

    def __ne__(self, _):
        return False

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–∏–ø–∞ "ANY"
any_type = AlwaysEqualProxy("*")


class SnJake_TeleportSet:
    """
    –ù–æ–¥–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (—É—Å—Ç–∞–Ω–æ–≤–∫–∏) –¥–∞–Ω–Ω—ã—Ö –≤ "—Ç–µ–ª–µ–ø–æ—Ä—Ç" –ø–æ–¥ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º.
    """
    # –ö–∞—Ç–µ–≥–æ—Ä–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω–æ–¥–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –º–µ–Ω—é ComfyUI
    CATEGORY = "üòé SnJake/Utils" # –ü–æ–º–µ—â–∞–µ–º –≤ Utils, –∫–∞–∫ –±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –º–µ—Å—Ç–æ

    # –ò–º–µ–Ω–∞ –∏ —Ç–∏–ø—ã –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    RETURN_TYPES = (any_type,)
    # –¢–∞–∫–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏–≥–Ω–∞–ª –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∫–≤–æ–∑–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (chaining)
    RETURN_NAMES = ("signal_passthrough",) 

    FUNCTION = "set_value"
    OUTPUT_NODE = True # –í–∞–∂–Ω–æ, —á—Ç–æ–±—ã —ç—Ç–∞ –Ω–æ–¥–∞ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å, –¥–∞–∂–µ –µ—Å–ª–∏ –µ–µ –≤—ã—Ö–æ–¥ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω

    @classmethod
    def INPUT_TYPES(cls):
        """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–¥—ã."""
        return {
            "required": {
                # –í—Ö–æ–¥ –¥–ª—è –ª—é–±–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
                "signal": (any_type, {}),
                # –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–∫–∞–Ω–∞–ª–∞ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞)
                "constant": ("STRING", {"default": "constant_name"}),
            }
        }

    def set_value(self, signal, constant):
        """
        –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
        """
        constant_clean = constant.strip()
        if not constant_clean:
            # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–∏–ª –∏–º—è –ø—É—Å—Ç—ã–º
            print("\033[93mWarning: [Teleport Set] –ò–º—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º. –°–∏–≥–Ω–∞–ª –Ω–µ –±—ã–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω.\033[0m")
            return (signal,) # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏–≥–Ω–∞–ª –∫–∞–∫ –µ—Å—Ç—å

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏ –∏–º—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        TELEPORT_DATA[constant_clean] = signal
        TELEPORT_CONSTANTS.add(constant_clean)

        print(f"Info: [Teleport Set] –°–∏–≥–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫–∞–Ω–∞–ª–µ '{constant_clean}'.")

        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Å–∏–≥–Ω–∞–ª, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–ø–æ—á–∫–∏ –¥–∞–ª—å—à–µ
        return (signal,)


class SnJake_TeleportGet:
    """
    –ù–æ–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è (–∏–∑–≤–ª–µ—á–µ–Ω–∏—è) –¥–∞–Ω–Ω—ã—Ö –∏–∑ "—Ç–µ–ª–µ–ø–æ—Ä—Ç–∞" –ø–æ –∏–º–µ–Ω–∏.
    """
    CATEGORY = "üòé SnJake/Utils"

    RETURN_TYPES = (any_type,)
    RETURN_NAMES = ("signal",)
    FUNCTION = "get_value"

    @classmethod
    def INPUT_TYPES(cls):
        """
        –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
        –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ –≤—Å–µ—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ –≥—Ä–∞—Ñ–µ Set-–Ω–æ–¥.
        """
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–º–µ–Ω –∫–æ–Ω—Å—Ç–∞–Ω—Ç –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é (COMBO)
        constants_list = sorted(list(TELEPORT_CONSTANTS))
        return {
            "required": {
                # –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏
                "constant": (constants_list, ),
            }
        }

    def get_value(self, constant):
        """
        –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–æ –∏–º–µ–Ω–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã.
        """
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None (ComfyUI –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ).
        value = TELEPORT_DATA.get(constant, None)

        if value is None:
            # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ Set-–Ω–æ–¥–∞ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å
            print(f"\033[93mWarning: [Teleport Get] –°–∏–≥–Ω–∞–ª –¥–ª—è –∫–∞–Ω–∞–ª–∞ '{constant}' –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–æ–∑–º–æ–∂–Ω–æ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –Ω–æ–¥–∞ Set –µ—â–µ –Ω–µ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.\033[0m")

        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –≤–∏–¥–µ –∫–æ—Ä—Ç–µ–∂–∞
        return (value,)
