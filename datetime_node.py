# ComfyUI/custom_nodes/MyDateTimeUtils/datetime_node.py
import datetime

class DateTimeToStringNode:
    @classmethod
    def INPUT_TYPES(cls):
        """
        –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø—ã –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–¥—ã.
        –≠—Ç–∞ –Ω–æ–¥–∞ –Ω–µ –∏–º–µ–µ—Ç –≤—Ö–æ–¥–æ–≤.
        """
        return {
            "required": {}  # –ù–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤
        }

    RETURN_TYPES = ("STRING",)  # –ù–æ–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω –≤—ã—Ö–æ–¥ —Ç–∏–ø–∞ STRING
    RETURN_NAMES = ("datetime_str",)  # –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–∫–µ—Ç–∞
    FUNCTION = "get_current_datetime_string"  # –ú–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω
    CATEGORY = "üòé SnJake/Utils"

    @classmethod
    def IS_CHANGED(cls, *args, **kwargs):
        """
        –°–æ–æ–±—â–∞–µ—Ç ComfyUI, —á—Ç–æ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –Ω–æ–¥—ã –∏–∑–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏.
        –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —Ç–∞–∫ –∫–∞–∫ –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –≤—Å–µ–≥–¥–∞ –Ω–æ–≤—ã–µ.
        –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ float("NaN") –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Å—á–µ—Ç.
        """
        return float("NaN")

    def get_current_datetime_string(self):
        """
        –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–æ–¥—ã. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è,
        —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏—Ö –≤ —Å—Ç—Ä–æ–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç.
        """
        now = datetime.datetime.now()
        
        # –§–æ—Ä–º–∞—Ç: YYYY-MM-DD_HH-MM-SS_ms (–≥–æ–¥-–º–µ—Å—è—Ü-–¥–µ–Ω—å_—á–∞—Å-–º–∏–Ω—É—Ç–∞-—Å–µ–∫—É–Ω–¥–∞_–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
        # –ü—Ä–∏–º–µ—Ä: 2023-10-27_15-30-45_123
        # –≠—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –∏ –¥–µ—Ñ–∏—Å—ã –≤–º–µ—Å—Ç–æ –ø—Ä–æ–±–µ–ª–æ–≤,
        # —á—Ç–æ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é "–í–º–µ—Å—Ç–æ –ø—Ä–æ–±–µ–ª–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∏–∂–Ω–∏–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è".
        # –ï—Å–ª–∏ –±—ã –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –º–æ–≥ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ datetime.ctime()),
        # —Ç–æ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –±—ã .replace(" ", "_").
        datetime_string = now.strftime("%Y-%m-%d_%H-%M-%S_%f")[:-3]  # –û–±—Ä–µ–∑–∞–µ–º –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã –¥–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
        
        return (datetime_string,) # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ –∫–æ—Ä—Ç–µ–∂–∞